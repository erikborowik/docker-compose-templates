#conf wsl
#wsl -d docker-desktop
#sysctl -w vm.max_map_count=262144
#-Delastic.apm.service_name=app-name -Delastic.apm.server_url=http://localhost:8200 -Delastic.apm.application_packages=* -javaagent:D:\java\elastic-apm-agent-1.47.0.jar 

# Executar via docker-compose
#docker-compose up -d

#Executar via docker swarm
#docker swarm init
#docker stack deploy -c docker-compose.yml elastic-apm
version: '3.9'
services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.17.0
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - xpack.security.http.ssl.enabled=false
      - "ES_JAVA_OPTS=-Xmx512m -Xms512m"
    ports:
      - "9200:9200"
    volumes:
      - esdata:/usr/share/elasticsearch/data
    networks:
      - elk

  kibana:
    image: docker.elastic.co/kibana/kibana:8.17.0
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    ports:
      - "5601:5601"
    networks:
      - elk
    depends_on:
      - elasticsearch

  apm-server: #NÃ£o validado
    image: docker.elastic.co/apm/apm-server:8.17.0
    command: >
      apm-server -e
        -E apm-server.host=0.0.0.0:8200
        -E setup.kibana.host=kibana:5601
        -E output.elasticsearch.hosts=["http://elasticsearch:9200"]
    ports:
      - "8200:8200"
    depends_on:
      - elasticsearch
      - kibana
    networks:
      - elk

volumes:
  esdata:

networks:
  elk:

 